<!DOCTYPE html>
<html lang="pl" xmlns:th="https://www.thymeleaf.org">
<head th:replace="~{fragments.html :: head('Analityka - SpaceControll')}"></head>
<body>
<div th:replace="~{fragments.html :: menu}"></div>
<div class="container mt-4"><h2 class="mb-3">Analityka</h2>
    <form method="get" th:action="@{/analytics}" class="row g-3 align-items-end mb-4">
        <div class="col-auto"><label for="from" class="form-label mb-0">Od:</label>
            <input type="datetime-local"
                   class="form-control"
                   id="from" name="from"
                   th:value="${#temporals.format(from, 'yyyy-MM-dd''T''HH:mm')}"/>
        </div>
        <div class="col-auto"><label for="to" class="form-label mb-0">Do:</label>
            <input type="datetime-local"
                   class="form-control" id="to"
                   name="to"
                   th:value="${#temporals.format(to, 'yyyy-MM-dd''T''HH:mm')}"/>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-outline-primary">Pokaż</button>
        </div>
        <div class="col-12">
            <div class="hint"> Okno analizy: <b th:text="${#temporals.format(from, 'yyyy-MM-dd HH:mm')}"></b> — <b
                    th:text="${#temporals.format(to, 'yyyy-MM-dd HH:mm')}"></b>, godziny pracy: <b
                    th:text="${startHour}"></b>:00–<b th:text="${endHour}"></b>:00
            </div>
        </div>
    </form>
    <div class="row g-3"> <!-- Wykorzystanie -->
        <div class="col-md-6">
            <div class="card p-3 metric-card">
                <div class="d-flex align-items-center"><h5 class="mb-0">Wykorzystanie</h5>
                    <span class="help-icon"
                          data-bs-toggle="tooltip"
                          title="Odsetek minut w godzinach pracy zajętych rezerwacjami (bez anulowanych), w wybranym oknie czasu."> ⓘ </span>
                </div>
                <p class="mt-2 mb-2"
                   th:text="'Zajęte minuty: ' + ${util.usedMinutes} + ' / Dostępne: ' + ${util.availableMinutes}"></p>
                <div class="progress mb-2">
                    <div class="progress-bar" role="progressbar"
                         th:style="'width:' + ${#numbers.formatDecimal(util.utilization * 100, 0, 0)} + '%'"
                         th:text="${#numbers.formatDecimal(util.utilization * 100, 1, 1)} + '%'">
                    </div>
                </div>
                <div class="hint"> Jak liczymy: sumujemy przecięcia rezerwacji z oknem czasu i godzinami pracy; pomijamy
                    anulowane. Dlaczego ważne: mierzy efektywność użycia sal (0–30% niskie, 30–70% typowe, >70% może
                    oznaczać braki).
                </div>
            </div>
        </div>
        <!-- No-show rate -->
        <div class="col-md-6">
            <div class="card p-3 metric-card">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0">No-show rate</h5>
                    <span class="help-icon" data-bs-toggle="tooltip"
                          title="Udział zakończonych rezerwacji bez potwierdzenia obecności (check-in) w wybranym oknie.">
        ⓘ
      </span>
                </div>
                <p class="mt-2 mb-1"
                   th:text="'No-show: ' + ${noshow.numerator} + ' z ' + ${noshow.denominator} + ' (' + ${#numbers.formatDecimal(noshow.rate*100,1,1)} + '%)'"></p>
                <div class="hint">
                    Jak liczymy: COMPLETED bez check-in w [from,to].
                    Dlaczego ważne: wysoki no-show „blokuje” sale bez realnego użycia; uzasadnia polityki typu
                    auto-release.
                </div>
            </div>
        </div>

        <!-- Cancellation rate -->
        <div class="col-md-6">
            <div class="card p-3 metric-card">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0">Cancellation rate</h5>
                    <span class="help-icon" data-bs-toggle="tooltip"
                          title="Udział anulowanych wśród rezerwacji utworzonych w wybranym oknie (wg createdAt).">
        ⓘ
      </span>
                </div>
                <p class="mt-2 mb-1"
                   th:text="'Anulacje: ' + ${cancel.numerator} + ' z ' + ${cancel.denominator} + ' (' + ${#numbers.formatDecimal(cancel.rate*100,1,1)} + '%)'"></p>
                <div class="hint">
                    Jak liczymy: status CANCELLED wśród rezerwacji utworzonych w [from,to].
                    Dlaczego ważne: wysoka liczba anulacji wskazuje na problemy z planowaniem i dostępnością.
                </div>
            </div>
        </div>

        <!-- Right-sizing -->
        <div class="col-md-6">
            <div class="card p-3 metric-card">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0">Dopasowanie pojemności (right-sizing)</h5>
                    <span class="help-icon" data-bs-toggle="tooltip"
                          title="Średnia różnica: pojemność sali minus liczba uczestników (tylko rezerwacje z check-in).">
        ⓘ
      </span>
                </div>
                <p class="mt-2 mb-1"
                   th:text="'Śr. nadmiar miejsc: ' + ${#numbers.formatDecimal(rightSizing.avgDifference, 1, 1)} + ' (N=' + ${rightSizing.sampleSize} + ')'"></p>
                <div class="hint">
                    Jak liczymy: dla spotkań z check-in: capacity − expectedAttendees; średnia w [from,to].
                    Dlaczego ważne: dodatnia wartość sugeruje przewymiarowanie sal; ujemna – niedobór miejsc.
                </div>
            </div>
        </div>

        <!-- Szczyt równoległych rezerwacji -->
        <div class="col-md-6">
            <div class="card p-3 metric-card">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0">Szczyt równoległych rezerwacji</h5>
                    <span class="help-icon" data-bs-toggle="tooltip"
                          title="Maksymalna liczba jednocześnie zajętych sal (bez anulowanych) w wybranym oknie.">
        ⓘ
      </span>
                </div>
                <p class="mt-2 mb-1"
                   th:text="'Peak: ' + ${peakOccupancy.peak} + ' ok. ' + ${#temporals.format(peakOccupancy.at, 'yyyy-MM-dd HH:mm')}"></p>
                <div class="hint">
                    Jak liczymy: „sweep line” na startach/końcach rezerwacji w [from,to].
                    Dlaczego ważne: pokazuje minimalną wymaganą równoległą liczbę sal i godziny największego obciążenia.
                </div>
            </div>
        </div>
    </div>
</div> <!-- Bootstrap JS (bundle zawiera Popper) -->
<th:block th:replace="~{fragments.html :: scripts}"></th:block>

<link rel="stylesheet" th:href="@{/css/analytics.css}"> <script th:src="@{/js/analytics.js}"></script> </body></body>
</html>